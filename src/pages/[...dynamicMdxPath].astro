---
import { getCollection, render } from 'astro:content';
import MarkdownPostLayout from '@/layouts/MarkdownPostLayout.astro';
import Link from '@/components/Link.astro';

import { generateStaticPathFromEntry } from '@/lib/mdxUtils';
import Block from '@/components/Block.astro';
import Album from '@/components/Album/Album.astro';
import ZoomableImage from '@/components/ZoomableImage.astro';
import Plotter from '@/components/Plotter/Plotter.astro';

import { Tweet, YouTube } from 'astro-embed';
import Kbd from '@/components/Kbd.astro';

export async function getStaticPaths() {

  const blogEntries = await getCollection('blog')
  const pageEntries = await getCollection('pages')

  const allDynamicMdxPaths: any[] = []
  
  blogEntries.forEach((entry: Awaited<ReturnType<typeof getCollection>>[number]) => {
    allDynamicMdxPaths.push(...generateStaticPathFromEntry(entry, 'blog/'))
  })

  pageEntries.forEach((entry: Awaited<ReturnType<typeof getCollection>>[number]) => {
    allDynamicMdxPaths.push(...generateStaticPathFromEntry(entry, ''))
  })

  return allDynamicMdxPaths

}

const { entry, redirect } = Astro.props

if (redirect) {
  return Astro.redirect(redirect)
}
const { Content, headings } = await render(entry)

---
<MarkdownPostLayout frontmatter={entry.data} headings={headings}>
  <Content
    components={{
      h1: "h2",
      h2: "h3",
      h3: "h4",
      h4: "h5",
      h5: "h6",
      a: Link,
      Block,
      Album,
      Plotter,
      img: ZoomableImage,
      Tweet,
      YouTube,
      Kbd,
    }}
  />
</MarkdownPostLayout>